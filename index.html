<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <title>Unity WebARProject</title>

    <!-- A-Frame + AR.js -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.js"></script>

    <style>
      html, body { margin: 0; padding: 0; overflow: hidden; background: #000; }
      /* scene behind Unity */
      a-scene { position: absolute; width: 100vw; height: 100vh; }
      /* Unity canvas on top */
      #unity-container,
      #unity-canvas,
      canvas {
        position: absolute; top: 0; left: 0;
        width: 100vw; height: 100vh;
        background: transparent !important;
        pointer-events: none;
      }
    </style>

    <!-- Debug components BEFORE your scene -->
    <script>
      // Logs markerFound / markerLost events
      AFRAME.registerComponent('marker-events', {
        init: function () {
          this.el.addEventListener('markerFound', () => {
            console.log(`[marker-events] found: #${this.el.id}`);
          });
          this.el.addEventListener('markerLost', () => {
            console.log(`[marker-events] lost:  #${this.el.id}`);
          });
        }
      });

      // Logs every tick & when cube would spawn/remove
      AFRAME.registerComponent('cube-follow', {
        init: function () {
          this.spawned = false;
          console.log(`[cube-follow] init on #${this.el.id}`);
        },
        tick: function () {
          const vis = this.el.object3D.visible;
          console.log(`[cube-follow] tick #${this.el.id} → visible: ${vis}`);
          if (vis && !this.spawned) {
            console.log(`[cube-follow] → WOULD SPAWN CUBE on #${this.el.id}`);
            this.spawned = true;
          }
          if (!vis && this.spawned) {
            console.log(`[cube-follow] → WOULD REMOVE CUBE on #${this.el.id}`);
            this.spawned = false;
          }
        }
      });
    </script>
  </head>

  <body>
    <!-- AR.js Scene -->
    <a-scene
      embedded
      vr-mode-ui="enabled: false"
      renderer="alpha: true; antialias: true;"
      arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: true;"
    >
      <!-- Hiro marker (quick test) -->
      <a-marker
        preset="hiro"
        id="hiro"
        marker-events
        cube-follow
      >
        <a-box color="red"></a-box>
      </a-marker>

      <!-- Your NFT marker -->
      <a-nft
        id="nft-marker"
        type="nft"
        url="UnityWebARTest/Descriptors/test2"
        smooth="true" smoothCount="10"
        smoothTolerance="0.01" smoothThreshold="5"
        marker-events
        cube-follow
      >
        <a-light type="ambient" intensity="1"></a-light>
      </a-nft>

      <a-entity camera></a-entity>
    </a-scene>

    <!-- Unity Canvas & Loader (unchanged) -->
    <div id="unity-container">
      <canvas id="unity-canvas" width="960" height="600"></canvas>
      <!-- …your existing loading UI… -->
    </div>
    <script>
      /* your existing Unity loader script here */
    </script>
  </body>
</html>
